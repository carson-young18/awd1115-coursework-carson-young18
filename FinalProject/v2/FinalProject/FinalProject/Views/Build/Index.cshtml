@model BuildViewModel
@{
	ViewBag.Title = "Builds";
}

@functions {
	string GetDeleteModalId(Build build)
	{
		return "#deleteModal" + build.BuildId;
	}
	string GetModalId(Build build)
	{
		return "deleteModal" + build.BuildId;
	}
}

@if (!string.IsNullOrEmpty(Model.Message))
{
	<div class="alert alert-dismissible fade show my-3 tempMsg" role="alert">
		@TempData["message"]
		<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
	</div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
	<h2 class="mb-0">Builds</h2>

	<a asp-action="AddEdit"
	   asp-controller="Build"
	   class="btn btn-primary">
		<i class="bi bi-plus-circle"></i> Create Build
	</a>
</div>

<form method="get" class="row g-2 mb-4">
	<div class="col-md-4">
		<select asp-for="SelectedCategoryId"
				class="form-select"
				asp-items="@(new SelectList(Model.Categories, "CategoryId", "Name", Model.SelectedCategoryId))">
			<option value="">All Categories</option>
		</select>
	</div>

	<div class="col-md-4">
		<select asp-for="SelectedChampionId"
				class="form-select"
				asp-items="@(new SelectList(Model.Champions, "ChampionId", "Name", Model.SelectedChampionId))">
			<option value="">All Champions</option>
		</select>
	</div>

	<div class="col-md-2">
		<button type="submit" class="btn btn-primary w-100">
			<i class="bi bi-funnel-fill"></i> Filter
		</button>
	</div>

	<div class="col-md-2">
		<a asp-action="ClearFilters"
		   class="btn btn-secondary w-100">
			Clear
		</a>
	</div>
</form>

<div class="row g-4">
	@foreach (Build build in Model.Builds)
	{
		<div class="col-lg-2 col-md-4">
			<form asp-action="Delete" asp-controller="Build" method="post">
				<input type="hidden" asp-for="@build.BuildId" name="id" />

				<div class="card h-100 shadow-sm">
					<img src="@Url.Content($"https://ddragon.leagueoflegends.com/cdn/{ViewBag.Patch}/img/champion/{build?.Champion?.Name}.png")"
						 class="card-img-top object-fit-contain p-3"
						 style="height: 180px;"
						 alt="@build?.Champion?.Name" />

					<div class="card-body d-flex flex-column">
						<h5 class="card-title mb-1">@build.Name</h5>

						<span class="text-muted small mb-2">
							@build.Champion.Name • @build.Category.Name
						</span>

						<p class="fw-semibold mb-3">
							Total Cost: @build.TotalCost g
						</p>

						<div class="mt-auto d-flex gap-2">
							<a class="btn btn-sm btn-outline-info w-100"
							   asp-controller="Build"
							   asp-action="AddEdit"
							   asp-route-id="@build.BuildId">
								<i class="bi bi-pencil-fill"></i> <br /> Edit
							</a>

							<button type="button"
									class="btn btn-sm btn-outline-danger w-100"
									data-bs-toggle="modal"
									data-bs-target="@GetDeleteModalId(build)">
								<i class="bi bi-trash"></i> Delete
							</button>
						</div>
					</div>
				</div>

				<div class="modal fade"
					 id="@GetModalId(build)"
					 tabindex="-1"
					 aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">
									Delete @build.Name?
								</h5>
								<button type="button"
										class="btn-close"
										data-bs-dismiss="modal"></button>
							</div>

							<div class="modal-footer">
								<button type="button"
										class="btn btn-secondary"
										data-bs-dismiss="modal">
									Cancel
								</button>
								<button type="submit"
										class="btn btn-danger">
									Delete
								</button>
							</div>
						</div>
					</div>
				</div>

			</form>
		</div>
	}
</div>